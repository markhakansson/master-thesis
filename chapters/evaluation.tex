This chapter will describe what methods have been used to evaluate that the
implementation in the previous chapter will solve the problem defintion. The
results from the evaluation will be discussed in the next chapter.

\section{Test configuration}
\begin{itemize}
    \item STM32 Nucleo-64 Development Board
\end{itemize}

\section{Test application}
The test application to test RAUK's functionality on, is an RTIC application
that toggles an LED on and off for an interval on the development board. In
addition there is a button that can be pressed by the user. Both the LED
functionality and the button functionality have been implemented as two
separate tasks, which are the only user tasks in the application. The tasks
also share some resources between each other. The button task have the higher
priority and will interrupt the LED task whenever the button is pressed.

For demonstration purposes both tasks calls the Cortex-M specific
\texttt{delay} function inside different conditional branches. This function
will try to stall the core for the specified cycles. Which will be useful to
see if all paths have been hit KLEE and that RAUK have measured it correctly.
The function does not delay for the exact given cycles and can sometimes delay
for twice the specified cycles.

The code for the tasks to be tested can be seen in Listing \ref{lst:evalbutton}
and \ref{lst:evaltoggle}. No deep understanding is needed, they will be
briefly explained in the next chapter.
\lstinputlisting[
    language={rust},
    %float=h,
    caption={Aperiodic task executed whenever the button is pressed.},
    label={lst:evalbutton},
]{../code/button_click.rs}

\lstinputlisting[
    language={rust},
    %float=h,
    caption={Periodic task that toggles the LED on and off.},
    label={lst:evaltoggle},
]{../code/toggle_led.rs}

\section{Measurement results}
RAUK has been tested on the test application built with and without release
optimizations. The release flag on the Rust package manager will optimize the
application which will greatly improve performance on the final binary.

The measured execution time (ET) using RAUK will be shown together with the
actual ET.  Which has been measured manually from the generated test vectors,
using the GNU debugger on the original application binary compiled without
using RAUK or its custom forks.

For no optimization one test vector generated, would result in an error and the
program crashing. Because a crashed program cannot be measured, it has thus
been discarded from the results.

\subsection{No optimization}
The test vectors generated by KLEE via the RAUK tool without optimizations can
be seen in Table \ref{tab:evaldebugtestsbutton} for the button task and in
Table \ref{tab:evaldebugteststoggle}. The result from measuring the execution
time for the test vectors are displayed in Table \ref{tab:evaldebugmeasure}.

\begin{table}[H]
    \centering
    \begin{longtable}{|c|c|c|c|}
    \hline
    Test no. & Task name & Resource name & Value (as integer) \\ \hline
    \multirow{3}{*}{1} & \multirow{3}{*}{\texttt{button\_click}} & \texttt{shared\_u8}  & 0 \\ \cline{3-4} 
                       &                                         & \texttt{shared\_u16} & 0 \\ \cline{3-4} 
                       &                                         & \texttt{dwt}         & 0 \\ \hline
    \multirow{3}{*}{2} & \multirow{3}{*}{\texttt{button\_click}} & \texttt{shared\_u8}  & 0 \\ \cline{3-4} 
                       &                                         & \texttt{shared\_u16} & 0 \\ \cline{3-4} 
                       &                                         & \texttt{dwt}         & 123456789 \\ \hline
    \end{longtable}
    \caption{KLEE generated test vectors for the \texttt{button\_click} task without any optimizations.}
    \label{tab:evaldebugtestsbutton}
\end{table}

\begin{table}[H]
    \centering
    \begin{longtable}{|c|c|c|c|}
    \hline
    Test no. & Task name & Resource name & Value (as integer) \\ \hline
    \multirow{3}{*}{3} & \multirow{3}{*}{\texttt{toggle\_led}} & \texttt{shared\_u8}  & 0 \\ \cline{3-4} 
                       &                                       & \texttt{shared\_u16} & 0 \\ \cline{3-4} 
                       &                                       & \texttt{led\_on}     & 0 \\ \hline
    \multirow{3}{*}{4} & \multirow{3}{*}{\texttt{toggle\_led}} & \texttt{shared\_u8}  & 0 \\ \cline{3-4} 
                       &                                       & \texttt{shared\_u16} & 0 \\ \cline{3-4} 
                       &                                       & \texttt{led\_on}     & 1 \\ \hline
    \multirow{3}{*}{5} & \multirow{3}{*}{\texttt{toggle\_led}} & \texttt{shared\_u8}  & 123 \\ \cline{3-4} 
                       &                                       & \texttt{shared\_u16} & 0 \\ \cline{3-4} 
                       &                                       & \texttt{led\_on}     & 0 \\ \hline
    \multirow{3}{*}{6} & \multirow{3}{*}{\texttt{toggle\_led}} & \texttt{shared\_u8}  & 123 \\ \cline{3-4} 
                       &                                       & \texttt{shared\_u16} & 0 \\ \cline{3-4} 
                       &                                       & \texttt{led\_on}     & 1 \\ \hline
    \multirow{3}{*}{7} & \multirow{3}{*}{\texttt{toggle\_led}} & \texttt{shared\_u8}  & 123 \\ \cline{3-4} 
                       &                                       & \texttt{shared\_u16} & 12345 \\ \cline{3-4} 
                       &                                       & \texttt{led\_on}     & 0 \\ \hline
    \multirow{3}{*}{8} & \multirow{3}{*}{\texttt{toggle\_led}} & \texttt{shared\_u8}  & 123 \\ \cline{3-4} 
                       &                                       & \texttt{shared\_u16} & 12345 \\ \cline{3-4} 
                       &                                       & \texttt{led\_on}      & 1 \\ \hline
    \end{longtable}
    \caption{KLEE generated test vectors for the \texttt{toggle\_led} task without any optimizations.}
    \label{tab:evaldebugteststoggle}
\end{table}

\begin{table}[H]
    \centering
    \begin{tabular}{|c | c | c | c|}
        \hline
        Test no. & Task name & Measured ET (cycles) & Actual ET (cycles) \\ [0.5ex]
        \hline
        1 & \texttt{button\_click} & 625 & 231 \\
        \hline
        2 & \texttt{button\_click} & 15 650 & 15 269 \\
        \hline
        3 & \texttt{toggle\_led} & 1399 & 1002  \\
        \hline
        4 & \texttt{toggle\_led} & 1401  & 999 \\
        \hline
        5 & \texttt{toggle\_led} & 2929  & 2532 \\
        \hline
        6 & \texttt{toggle\_led} & 2930 & 2529 \\
        \hline
        7 & \texttt{toggle\_led} & 17 972 & 17 575 \\
        \hline
        8 & \texttt{toggle\_led} & 17 973 & 17 572 \\
        \hline
    \end{tabular}
    \caption{Measured execution times (ET) in clock cycles for the test application without any optimizations, from the generated test vectors.}
    \label{tab:evaldebugmeasure}
\end{table}

\subsection{Release optimization}

\begin{table}[H]
    \centering
    \begin{longtable}{|c|c|c|c|}
    \hline
    Test no. & Task name & Resource name & Value (as integer) \\ \hline
    \multirow{3}{*}{1} & \multirow{3}{*}{\texttt{button\_click}} & \texttt{shared\_u8}  & 0 \\ \cline{3-4} 
                       &                                         & \texttt{shared\_u16} & 0 \\ \cline{3-4} 
                       &                                         & \texttt{dwt}         & 0 \\ \hline
    \end{longtable}
    \caption{KLEE generated test vectors for the \texttt{button\_click} task with release optimizations.}
    \label{tab:evalreleasetestsbutton}
\end{table}

\begin{table}[H]
    \centering
    \begin{longtable}{|c|c|c|c|}
    \hline
    Test no. & Task name & Resource name & Value (as integer) \\ \hline
    \multirow{3}{*}{2} & \multirow{3}{*}{\texttt{toggle\_led}} & \texttt{shared\_u8}  & 123 \\ \cline{3-4} 
                       &                                       & \texttt{shared\_u16} & 12345 \\ \cline{3-4} 
                       &                                       & \texttt{led\_on}     & 0 \\ \hline
    \multirow{3}{*}{3} & \multirow{3}{*}{\texttt{toggle\_led}} & \texttt{shared\_u8}  & 0 \\ \cline{3-4} 
                       &                                       & \texttt{shared\_u16} & 0 \\ \cline{3-4} 
                       &                                       & \texttt{led\_on}     & 0 \\ \hline
    \multirow{3}{*}{4} & \multirow{3}{*}{\texttt{toggle\_led}} & \texttt{shared\_u8}  & 123 \\ \cline{3-4} 
                       &                                       & \texttt{shared\_u16} & 12345 \\ \cline{3-4} 
                       &                                       & \texttt{led\_on}     & 1 \\ \hline
    \multirow{3}{*}{5} & \multirow{3}{*}{\texttt{toggle\_led}} & \texttt{shared\_u8}  & 0 \\ \cline{3-4} 
                       &                                       & \texttt{shared\_u16} & 0 \\ \cline{3-4} 
                       &                                       & \texttt{led\_on}     & 255 \\ \hline
    \end{longtable}
    \caption{KLEE generated test vectors for the \texttt{toggle\_led} task with release optimizations.}
    \label{tab:evalreleaseteststoggle}
\end{table}

\begin{table}[H]
    \centering
    \begin{tabular}{|c | c | c | c|}
        \hline
        Test no. & Task name & Measured ET (cycles) & Actual ET (cycles) \\ [0.5ex]
        \hline
        1 & \texttt{button\_click} & 263 & 23 \\
        \hline
        2 & \texttt{toggle\_led} & 16 939 & 16 568 \\
        \hline
        3 & \texttt{toggle\_led} & 405 & 36 \\
        \hline
        4 & \texttt{toggle\_led} & 16 934 & 16 567 \\
        \hline
        5 & \texttt{toggle\_led} & 403 & 24 \\
        \hline
    \end{tabular}
    \caption{Measured execution times (ET) in clock cycles for the test application without any optimizations, from the generated test vectors.}
    \label{tab:evalreleasemeasure}
\end{table}

\section{Schedulability results}
